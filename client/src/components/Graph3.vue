<template>
  <div ref="graph"></div>
</template>

<script>
import echarts from "echarts";
import _ from "lodash";

export default {
  name: "Graph3",
  props: {
    data: "",
    week: "",
    dept: ""
  },
  data() {
    return {
      maleObj: {},
      femaleObj: {},
      maleArr: [],
      femaleArr: [],
      arr: [],
      revenue: [] 
    };
  },
  mounted() {
    this.drawGraph(this.$refs.graph);
    // this.$http.get(`graph3`).then(response => {
    //   this.sqlData = response.data;
    // });
  },
  methods: {
    drawGraph(el) {
      const self = this
      // Graph 3
      let myChart = echarts.init(el);
      let week = this.week
      // 指定图表的配置项和数据
      var times = ['周一早', '周一中', '周一晚',
                   '周二早', '周二中', '周二晚',
                   '周三早', '周三中', '周三晚',
                   '周四早', '周四中', '周四晚',
                   '周五早', '周五中', '周五晚',
                   '周六早', '周六中', '周六晚',
                   '周日早', '周日中', '周日晚'];
      var dept = ["一食堂","二食堂","三食堂","四食堂","五食堂"];

      var data = {
        'week1':[[0,0,217],[0,1,186],[0,2,135],[0,3,178],[0,4,168],[0,5,122],[0,6,166],[0,7,180],[0,8,169],[0,9,235],[0,10,203],[0,11,138],[0,12,150],[0,13,432],[0,14,270],[0,15,46],[0,16,315],[0,17,219],[0,18,28],[0,19,296],[0,20,87],[1,0,575],[1,1,412],[1,2,288],[1,3,492],[1,4,437],[1,5,285],[1,6,613],[1,7,384],[1,8,409],[1,9,592],[1,10,435],[1,11,320],[1,12,1],[1,13,194],[2,0,329],[2,1,222],[2,2,10],[2,3,321],[2,4,227],[2,5,274],[2,6,271],[2,7,13],[2,8,278],[2,9,290],[2,10,5],[2,11,228],[2,12,166],[2,13,9],[2,14,199],[2,15,165],[2,16,273],[2,17,146],[3,0,530],[3,1,369],[3,2,619],[3,3,478],[3,4,471],[3,5,508],[3,6,643],[3,7,499],[3,8,6],[3,9,174],[4,0,395],[4,1,516],[4,2,280],[4,3,403],[4,4,517],[4,5,301],[4,6,381],[4,7,530],[4,8,426],[4,9,411],[4,10,492],[4,11,326],[4,12,171]],
        'week2':[[0,0,159],[0,1,167],[0,2,153],[0,3,283],[0,4,168],[0,5,179],[0,6,260],[0,7,179],[0,8,171],[0,9,225],[0,10,189],[0,11,89],[0,12,35],[0,13,120],[0,14,88],[0,15,25],[0,16,67],[0,17,84],[0,18,8],[0,19,60],[0,20,89],[1,0,673],[1,1,440],[1,2,377],[1,3,676],[1,4,434],[1,5,398],[1,6,648],[1,7,464],[1,8,395],[1,9,657],[1,10,440],[1,11,330],[1,12,707],[1,13,467],[1,14,321],[1,15,243],[1,16,307],[1,17,205],[1,18,163],[1,19,274],[1,20,227],[2,0,7],[2,1,329],[2,2,286],[2,3,6],[2,4,316],[2,5,279],[2,6,7],[2,7,369],[2,8,260],[2,9,6],[2,10,340],[2,11,283],[2,12,63],[2,13,311],[2,14,269],[2,15,4],[2,16,143],[2,17,121],[2,18,1],[2,19,167],[2,20,153],[3,0,651],[3,1,492],[3,2,653],[3,3,530],[3,4,599],[3,5,562],[3,6,631],[3,7,492],[3,8,584],[3,9,356],[3,10,253],[3,11,274],[3,12,280],[3,13,326],[4,0,398],[4,1,537],[4,2,428],[4,3,439],[4,4,564],[4,5,396],[4,6,476],[4,7,541],[4,8,399],[4,9,413],[4,10,485],[4,11,326],[4,12,390],[4,13,464],[4,14,466],[4,15,193],[4,16,224],[4,17,202],[4,18,143],[4,19,255],[4,20,252]],
        'week3':[[0,0,165],[0,1,148],[0,2,169],[0,3,198],[0,4,157],[0,5,138],[0,6,141],[0,7,187],[0,8,134],[0,9,170],[0,10,140],[0,11,109],[0,12,138],[0,13,99],[0,14,85],[0,15,21],[0,16,40],[0,17,60],[0,18,12],[0,19,58],[0,20,83],[1,0,569],[1,1,442],[1,2,366],[1,3,823],[1,4,401],[1,5,335],[1,6,841],[1,7,476],[1,8,423],[1,9,625],[1,10,406],[1,11,274],[1,12,663],[1,13,416],[1,14,296],[1,15,260],[1,16,265],[1,17,214],[1,18,131],[1,19,286],[1,20,232],[2,0,1],[2,1,318],[2,2,270],[2,3,9],[2,4,361],[2,5,243],[2,6,5],[2,7,349],[2,8,323],[2,9,6],[2,10,286],[2,11,291],[2,12,2],[2,13,310],[2,14,240],[2,15,1],[2,16,206],[2,17,136],[2,18,214],[2,19,164],[3,0,612],[3,1,461],[3,2,644],[3,3,498],[3,4,540],[3,5,428],[3,6,581],[3,7,508],[3,8,519],[3,9,360],[3,10,314],[3,11,236],[3,12,255],[3,13,294],[4,0,393],[4,1,533],[4,2,377],[4,3,417],[4,4,542],[4,5,377],[4,6,499],[4,7,505],[4,8,332],[4,9,392],[4,10,429],[4,11,271],[4,12,413],[4,13,450],[4,14,303],[4,15,199],[4,16,258],[4,17,168],[4,18,85],[4,19,246],[4,20,219]],
        'week4':[[0,0,99],[0,1,160],[0,2,130],[0,3,249],[0,4,154],[0,5,126],[0,6,174],[0,7,176],[0,8,115],[0,9,191],[0,10,119],[0,11,87],[0,12,156],[0,13,99],[0,14,49],[1,0,696],[1,1,454],[1,2,390],[1,3,681],[1,4,458],[1,5,386],[1,6,651],[1,7,423],[1,8,363],[1,9,611],[1,10,421],[1,11,337],[1,12,673],[1,13,395],[1,14,272],[1,15,170],[1,16,383],[1,17,281],[2,0,325],[2,1,298],[2,2,1],[2,3,360],[2,4,283],[2,5,5],[2,6,347],[2,7,220],[2,8,5],[2,9,356],[2,10,285],[2,11,298],[2,12,150],[3,0,508],[3,1,501],[3,2,599],[3,3,523],[3,4,2],[3,5,583],[3,6,401],[3,7,571],[3,8,388],[3,9,544],[3,10,227],[4,0,329],[4,1,519],[4,2,358],[4,3,396],[4,4,486],[4,5,304],[4,6,435],[4,7,462],[4,8,304],[4,9,333],[4,10,436],[4,11,269],[4,12,377],[4,13,388],[4,14,143],[4,15,94],[4,16,157],[4,17,90]],
        'week5':[[0,0,46],[0,1,93],[0,2,122],[0,3,66],[0,4,98],[0,5,127],[1,0,391],[1,1,281],[1,2,240],[1,3,242],[1,4,303],[1,5,308],[2,0,11],[2,1,233],[2,2,157],[2,3,6],[2,4,237],[2,5,197],[3,0,344],[3,1,309],[3,2,350],[3,3,332],[4,0,167],[4,1,311],[4,2,254],[4,3,172],[4,4,286],[4,5,290]]
      };
      data[week] = data[week].map(function (item) {
          return [item[1], item[0], item[2] || '-'];
      });

      // 指定图表的配置项和数据
      let option = {
        title:{
          text:"各食堂就餐人数",
          x:"center",
          y: 'top',
          textStyle: {
            fontSize: 14,
            color: '#747779'
          }
        },
          tooltip: {
              position: 'top'
          },
          animation: false,
          grid: {
              height: '60%',
              y: '10%'
          },
          xAxis: {
              type: 'category',
              data: times,
              splitArea: {
                  show: true
              },
            axisLabel:{
              interval:0,
              rotate:30,
              splitLine:false,
              textStyle:{
                fontSize:10,
                color:"#000"
              }
            }
          },
          yAxis: {
              type: 'category',
              data: dept,
              triggerEvent: true,
              splitArea: {
                  show: true
              },
            axisTick:{
              show:false
            }
          },
          visualMap: {
              min: 0,
              max: 500,
              // calculable: true,
              orient: 'vertical',
              itemWidth:'5px',
              left: 'right',
              top:'center',
              bottom: '15%',
              inRange: {
                  color: ['#C7EAFD','#6AB0B8']
              }
          },
          series: [{
              name: 'Punch Card',
              type: 'heatmap',
              data: data[week],
              label: {
                  normal: {
                      show: true,
                    fontSize:8
                  }
              },
              itemStyle: {
                  emphasis: {
                      shadowBlur: 10,
                      shadowColor: 'rgba(0, 0, 0, 0.5)'
                  }
              }
          }]
      };

      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);
      myChart.on('click', function (params) {
          // 控制台打印数据的名称
          if(params.componentType =="yAxis")
            self.$emit('updateDept', params.value)
      });
      window.onresize = function(){
        myChart.resize();
      }
    }
  },
  watch: {
    data: function(newValue, oldValue) {
      const self = this
      self.drawGraph(self.$refs.graph);
    }
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
</style>
